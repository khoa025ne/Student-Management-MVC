@model DataAccess.Entities.Student
@using DataAccess.Enums
@using System.ComponentModel.DataAnnotations

@{
    ViewData["Title"] = "Hồ sơ sinh viên";
    var majorName = typeof(MajorType).GetField(Model.Major.ToString())?.GetCustomAttributes(typeof(DisplayAttribute), false).Cast<DisplayAttribute>().FirstOrDefault()?.Name ?? Model.Major.ToString();
}

<div class="space-y-6">
    <!-- Page Header -->
    <div class="page-header animate-fadeIn">
        <div>
            <h1><i class="fas fa-user-circle"></i>Hồ sơ sinh viên</h1>
            <p>Thông tin cá nhân và học tập của bạn</p>
        </div>
        <a asp-action="Edit" class="btn btn-primary">
            <i class="fas fa-user-edit me-2"></i>Chỉnh sửa
        </a>
    </div>

    <div class="row g-4">
        <!-- Profile Card -->
        <div class="col-lg-4">
            <div class="glass-card animate-fadeIn" style="text-align: center;">
                <!-- Avatar -->
                <div class="profile-avatar-container">
                    @if (!string.IsNullOrEmpty(Model.AvatarUrl))
                    {
                        <img src="@Model.AvatarUrl" class="profile-avatar" alt="Avatar">
                    }
                    else
                    {
                        <div class="profile-avatar-placeholder">
                            @(Model.FullName?.Substring(0, 2).ToUpper() ?? "SV")
                        </div>
                    }
                </div>

                <h4 class="fw-bold mb-1">@Model.FullName</h4>
                <p class="text-muted mb-3">@Model.StudentCode</p>

                <!-- GPA Badge -->
                <div class="gpa-display mb-4">
                    <div class="gpa-circle @(Model.OverallGPA >= 3.5 ? "gpa-excellent" : Model.OverallGPA >= 2.5 ? "gpa-good" : "gpa-average")">
                        <span class="gpa-value">@Model.OverallGPA.ToString("0.00")</span>
                        <span class="gpa-label">GPA</span>
                    </div>
                </div>

                <!-- Major Alert -->
                @if (Model.Major == MajorType.Undefined)
                {
                    <div class="alert-card alert-info mb-3">
                        <i class="fas fa-info-circle"></i>
                        <span>Ngành học sẽ được admin thiết lập</span>
                    </div>
                }
                else
                {
                    <div class="major-badge mb-3">
                        <i class="fas fa-graduation-cap me-2"></i>@majorName
                    </div>
                    <div class="alert alert-info p-2 small">
                        <i class="fas fa-lock me-1"></i>Ngành học do admin quản lý
                    </div>
                }
            </div>

            <!-- Quick Stats -->
            <div class="glass-card animate-fadeIn mt-4" style="animation-delay: 0.1s;">
                <h6 class="fw-semibold mb-3">
                    <i class="fas fa-chart-pie me-2" style="color: var(--primary);"></i>Thống kê
                </h6>
                <div class="d-flex flex-column gap-3">
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="text-muted small">Kỳ học hiện tại</span>
                        <span class="fw-semibold">
                            @(Model.CurrentTermNo.HasValue ? $"Kỳ {Model.CurrentTermNo}" : "Chưa xác định")
                        </span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="text-muted small">Lớp</span>
                        <span class="fw-semibold">@Model.ClassCode</span>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <span class="text-muted small">Xếp loại</span>
                        <span class="badge-modern @(Model.OverallGPA >= 3.5 ? "badge-success" : Model.OverallGPA >= 2.5 ? "badge-warning" : "badge-secondary")">
                            @(Model.OverallGPA >= 3.5 ? "Xuất sắc" : Model.OverallGPA >= 3.0 ? "Giỏi" : Model.OverallGPA >= 2.5 ? "Khá" : "Trung bình")
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Card -->
        <div class="col-lg-8">
            <div class="glass-card animate-fadeIn" style="animation-delay: 0.15s;">
                <h5 class="fw-semibold mb-4">
                    <i class="fas fa-id-card me-2" style="color: var(--primary);"></i>Thông tin cá nhân
                </h5>

                <div class="info-list">
                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-id-badge"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Mã sinh viên</span>
                            <span class="info-value">@Model.StudentCode</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Họ và tên</span>
                            <span class="info-value">@Model.FullName</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Email</span>
                            <span class="info-value">@Model.Email</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Số điện thoại</span>
                            <span class="info-value">
                                @(!string.IsNullOrEmpty(Model.PhoneNumber) ? Model.PhoneNumber : "Chưa cập nhật")
                            </span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-birthday-cake"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Ngày sinh</span>
                            <span class="info-value">@Model.DateOfBirth.ToString("dd/MM/yyyy")</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-graduation-cap"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Ngành học</span>
                            <span class="info-value">
                                @if (Model.Major == MajorType.Undefined)
                                {
                                    <span class="badge-modern badge-warning">Chưa xác định</span>
                                }
                                else
                                {
                                    <span class="badge-modern badge-success">@majorName</span>
                                }
                            </span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Lớp</span>
                            <span class="info-value">@Model.ClassCode</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">GPA tích lũy</span>
                            <span class="info-value fw-bold @(Model.OverallGPA >= 3.5 ? "text-success" : Model.OverallGPA >= 2.5 ? "text-warning" : "text-danger")">
                                @Model.OverallGPA.ToString("0.00") / 4.00
                            </span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="info-content">
                            <span class="info-label">Kỳ học hiện tại</span>
                            <span class="info-value">
                                @(Model.CurrentTermNo.HasValue ? $"Kỳ {Model.CurrentTermNo}" : "Chưa xác định")
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card animate-fadeIn mt-4" style="animation-delay: 0.2s;">
                <h5 class="fw-semibold mb-4">
                    <i class="fas fa-bolt me-2" style="color: var(--primary);"></i>Thao tác nhanh
                </h5>
                <div class="row g-3">
                    <div class="col-sm-6 col-md-3">
                        <a asp-controller="Schedule" asp-action="Index" class="quick-action-card">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Xem lịch học</span>
                        </a>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <a asp-controller="Enrollments" asp-action="MyEnrollments" class="quick-action-card">
                            <i class="fas fa-book"></i>
                            <span>Môn đã đăng ký</span>
                        </a>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <a asp-controller="Scores" asp-action="MyGrades" class="quick-action-card">
                            <i class="fas fa-chart-bar"></i>
                            <span>Xem điểm</span>
                        </a>
                    </div>
                    <div class="col-sm-6 col-md-3">
                        <a asp-controller="Enrollments" asp-action="Register" class="quick-action-card">
                            <i class="fas fa-plus-circle"></i>
                            <span>Đăng ký môn</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .profile-avatar-container {
        margin-bottom: 1.5rem;
    }
    .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid var(--primary);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }
    .profile-avatar-placeholder {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: 700;
        color: white;
        margin: 0 auto;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }
    .gpa-display {
        display: flex;
        justify-content: center;
    }
    .gpa-circle {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border: 4px solid;
    }
    .gpa-excellent { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
    .gpa-good { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
    .gpa-average { border-color: #6b7280; background: rgba(107, 114, 128, 0.1); }
    .gpa-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
    }
    .gpa-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
    }
    .major-badge {
        display: inline-block;
        padding: 0.75rem 1.5rem;
        background: linear-gradient(135deg, var(--primary) 0%, var(--primary-hover) 100%);
        color: white;
        border-radius: 50px;
        font-weight: 600;
    }
    .alert-card {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        border-radius: 8px;
    }
    .alert-warning {
        background: rgba(245, 158, 11, 0.15);
        color: #d97706;
    }
    .info-list {
        display: flex;
        flex-direction: column;
        gap: 0;
    }
    .info-item {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 0;
        border-bottom: 1px solid var(--border-color);
    }
    .info-item:last-child {
        border-bottom: none;
    }
    .info-icon {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        background: rgba(182, 221, 218, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--primary);
        flex-shrink: 0;
    }
    .info-content {
        flex: 1;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .info-label {
        color: var(--text-muted);
        font-size: 0.875rem;
    }
    .info-value {
        color: var(--text-primary);
        font-weight: 500;
    }
    .quick-action-card {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
        padding: 1.5rem;
        background: var(--bg-secondary);
        border-radius: 12px;
        color: var(--text-primary);
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .quick-action-card:hover {
        background: var(--primary);
        color: white;
        transform: translateY(-2px);
    }
    .quick-action-card i {
        font-size: 1.5rem;
    }
    .quick-action-card span {
        font-size: 0.875rem;
        font-weight: 500;
    }
</style>
